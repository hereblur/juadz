"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[522],{1184:(e,r,n)=>{n.d(r,{R:()=>i,x:()=>o});var t=n(4041);const s={},a=t.createContext(s);function i(e){const r=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(a.Provider,{value:r},e.children)}},6097:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"tutorial/data-repository","title":"Data Repository","description":"The data repository is the bridge between your resource schema and your database. Juadz uses a provider pattern to abstract database operations, making it easy to swap or extend data sources.","source":"@site/docs/tutorial/4-data-repository.md","sourceDirName":"tutorial","slug":"/tutorial/data-repository","permalink":"/juadz/docs/tutorial/data-repository","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tutorial/4-data-repository.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Resource Schema","permalink":"/juadz/docs/tutorial/schema"},"next":{"title":"Resource","permalink":"/juadz/docs/tutorial/resource"}}');var s=n(1085),a=n(1184);const i={sidebar_position:4},o="Data Repository",d={},l=[{value:"Using existing provider",id:"using-existing-provider",level:2},{value:"Data Provider Overview",id:"data-provider-overview",level:2},{value:"Example: Implementing a Data Provider",id:"example-implementing-a-data-provider",level:2},{value:"List Function",id:"list-function",level:2},{value:"QueryListParam",id:"querylistparam",level:3},{value:"QueryFilter",id:"queryfilter",level:3},{value:"QueryRange",id:"queryrange",level:3},{value:"QuerySort",id:"querysort",level:3},{value:"QueryListResults",id:"querylistresults",level:3},{value:"Example: List Implementation",id:"example-list-implementation",level:2},{value:"Summary",id:"summary",level:2}];function c(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"data-repository",children:"Data Repository"})}),"\n",(0,s.jsx)(r.p,{children:"The data repository is the bridge between your resource schema and your database. Juadz uses a provider pattern to abstract database operations, making it easy to swap or extend data sources."}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"using-existing-provider",children:"Using existing provider"}),"\n",(0,s.jsxs)(r.p,{children:["Juadz supports several ready-to-use data providers, such as ",(0,s.jsx)(r.code,{children:"@juadz/knex"})," for SQL databases. These providers implement the required interface and handle common database operations for you."]}),"\n",(0,s.jsx)(r.p,{children:"To use an existing provider, simply import it and pass your resource schema and database connection:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",metastring:'title="database/user.ts"',children:'import { KnexProvider } from "@juadz/knex";\nimport { z } from "zod";\nimport knexConnection from "./knexConnection";\n\nconst userSchema = z.object({\n  id: z.number().meta({ $create: false, $update: false }),\n  name: z.string().meta({ $search: true }),\n  age: z.number().min(18),\n  salary: z.number().meta({ $view: \'manager\', $update: \'manager\' }),\n  password: z.string().min(8).meta({ $view: false }),\n});\n\nconst userRepository = KnexProvider("users", userSchema, knexConnection);\n'})}),"\n",(0,s.jsxs)(r.p,{children:["This gives you a fully functional ",(0,s.jsx)(r.code,{children:"IDataRepositoryProvider"})," for your resource, ready to use with Juadz REST endpoints. You can swap providers or customize them as needed for different databases."]}),"\n",(0,s.jsx)(r.h2,{id:"data-provider-overview",children:"Data Provider Overview"}),"\n",(0,s.jsx)(r.p,{children:"A data provider connects your resource schema to the underlying database. It implements a standard interface, ensuring consistent behavior across different database engines."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",metastring:'title="IDataRepositoryProvider"',children:'export interface IDataRepositoryProvider<T> {\n    schema: ZodObject<any>;\n    name: string;\n\n    get?: (id: TypeID) => Promise<T | null>;\n    update?: (id: TypeID, patch: Partial<T>) => Promise<T | null>;\n    replace?: (id: TypeID, data: T) => Promise<T | null>;\n    create?: (data: Omit<T, "id">) => Promise<T>;\n    delete?: (id: TypeID) => Promise<number>;\n    list?: QueryListFunction<T>;\n}\n'})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"schema"}),": The Zod schema for your resource, as defined in the previous chapter."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"name"}),": The name of the resource, typically matching the database table or collection."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"get"}),": Retrieves a single record by its ID."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"update"}),": Updates fields of an existing record."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"replace"}),": Replaces an entire record."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"create"}),": Inserts a new record."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"delete"}),": Removes a record by ID."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"list"}),": Returns a filtered, sorted, and paginated list of records."]}),"\n"]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"example-implementing-a-data-provider",children:"Example: Implementing a Data Provider"}),"\n",(0,s.jsx)(r.p,{children:"Here\u2019s a simple example using an in-memory array:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'import { z } from "zod";\n\nconst userSchema = z.object({\n  id: z.number(),\n  name: z.string(),\n  age: z.number(),\n});\n\nlet users: Array<z.infer<typeof userSchema>> = [];\ntype TUser = z.infer<typeof userSchema>;\n\nexport const UserProvider: IDataRepositoryProvider<TUser> = {\n  schema: userSchema,\n  name: "users",\n\n  get: async (id) => users.find(u => u.id === id) || null,\n  create: async (data) => {\n    const newUser = { ...data, id: users.length + 1 };\n    users.push(newUser);\n    return newUser;\n  },\n  // Implement update, replace, delete, list as needed...\n};\n'})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"list-function",children:"List Function"}),"\n",(0,s.jsxs)(r.p,{children:["The ",(0,s.jsx)(r.code,{children:"list"})," method enables advanced querying, including filtering, sorting, and pagination. It accepts a ",(0,s.jsx)(r.code,{children:"QueryListParam"})," object and returns a ",(0,s.jsx)(r.code,{children:"QueryListResults<T>"}),"."]}),"\n",(0,s.jsx)(r.h3,{id:"querylistparam",children:"QueryListParam"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'export type QueryListParam = {\n    resource: string;           // Resource name (e.g., "users")\n    filter: QueryFilter[];      // Array of filter conditions\n    range: QueryRange;          // Pagination info\n    sort: QuerySort[];          // Sorting instructions\n};\n'})}),"\n",(0,s.jsx)(r.h3,{id:"queryfilter",children:"QueryFilter"}),"\n",(0,s.jsx)(r.p,{children:"Defines a filter condition for a field."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"export type QueryFilter = {\n    field: string;              // Field to filter on\n    op: QueryFilterOperator;    // Operator (e.g., '=', '>', 'in')\n    value: number | string | Date | Array<number | string | Date>;\n};\n"})}),"\n",(0,s.jsx)(r.h3,{id:"queryrange",children:"QueryRange"}),"\n",(0,s.jsx)(r.p,{children:"Specifies pagination details."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"export type QueryRange = {\n    offset: number;             // Starting index\n    limit: number;              // Maximum number of records to return\n};\n"})}),"\n",(0,s.jsx)(r.h3,{id:"querysort",children:"QuerySort"}),"\n",(0,s.jsx)(r.p,{children:"Defines sorting for a field."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'export type QuerySort = {\n    field: string;              // Field to sort by\n    direction: "ASC" | "DESC";  // Sort direction\n};\n'})}),"\n",(0,s.jsx)(r.h3,{id:"querylistresults",children:"QueryListResults"}),"\n",(0,s.jsx)(r.p,{children:"The result of a list query."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"export type QueryListResults<T> = {\n    data: T[];                  // Array of records\n    total: number;              // Total number of matching records\n};\n"})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"example-list-implementation",children:"Example: List Implementation"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'async function list(query: QueryListParam): Promise<QueryListResults<User>> {\n  // Example: filter, sort, and paginate users array\n  let result = users;\n\n  // Apply filters\n  for (const f of query.filter) {\n    result = result.filter(user => user[f.field] === f.value);\n  }\n\n  // Apply sorting\n  for (const s of query.sort) {\n    result = result.sort((a, b) =>\n      s.direction === "ASC"\n        ? a[s.field] > b[s.field] ? 1 : -1\n        : a[s.field] < b[s.field] ? 1 : -1\n    );\n  }\n\n  // Apply pagination\n  const paged = result.slice(query.range.offset, query.range.offset + query.range.limit);\n\n  return {\n    data: paged,\n    total: result.length,\n  };\n}\n'})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(r.p,{children:"Juadz\u2019s data repository pattern makes it easy to connect your resource schemas to any database. By implementing the standard provider interface, you gain powerful querying, validation, and extensibility with minimal boilerplate."})]})}function u(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);