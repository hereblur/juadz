import JuadzFastify from '@juadz/fastify';
import { initDatabase } from './database';
import fastify from 'fastify';
import authProvider, { API_KEY } from './auth'
import UserResource from './resource/Users';

async function main() {
    // Create and start fastify server
    const server = fastify({
        logger: true
    });

    await initDatabase();

    server.get("/ping", async () => {
        return { pong: "it worked!" };
    });

    // Apply defined resources to fastify, Its' will generate routes and documentations
    await server.register(JuadzFastify, {
        prefix: "/api/v1",
        resources: [
            UserResource,
        ],
        authentication: authProvider,
        docs: {
            title: "Juadz Fastify Example",
            description: `Server api key is ${API_KEY}`,
            version: "0.0.1",
            url: ["http://localhost:3000"],
        },
    });

    await server.ready();

    await server.listen({ port: 3000 });
    console.log('ðŸš€ Server running on http://localhost:3000');
    console.log('ðŸ“š API docs at http://localhost:3000/documentations');
}

main().catch(console.error);

